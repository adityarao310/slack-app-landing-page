<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/main.js" defer></script>
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">
    <link rel="icon" type="image/png" href="img/final_images/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="img/final_images/favicon-16x16.png" sizes="16x16" />
    <title>Success | Kaapi</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        window.fwSettings = {
            'widget_id': 81000000425
        };
        !function () { if ("function" != typeof window.FreshworksWidget) { var n = function () { n.q.push(arguments) }; n.q = [], window.FreshworksWidget = n } }()
    </script>
    <script type='text/javascript' src='https://ind-widget.freshworks.com/widgets/81000000425.js' async defer></script>
</head>

<body>
    <div class="container container--large header-09__container">
        <div class="header-09__main">
            <div class="header-09__main_content">
                <h1 id="main_title" class="heading heading--accent header-09__heading">Successfully installed<img class="emoji  " src="img/emoji/cartwheel.png" alt="Emoji" /></h1>

                <p id="disclaimer_success_page">You can also find Kaapi inside your Slack workspace
                    by typing <em>ctrl+k or cmd+k
                    </em></p>
            </div>
        </div>
        <div class="header-09__img">
            <div class="header-09__img_wrapper">

                <div class="header-09__big_mockup">
                    <div class="mockup  mockup--white mockup--macbook mockup--portrait ">
                        <div class="mockup__container">

                            <div class="mockup__case">
                                <div class="mockup__spacer"></div>
                                <div class="mockup__screen">
                                    <div class="mockup__screenshot" style="background-image: url(https://raw.githubusercontent.com/adityarao310/slack-app-landing-page/master/img/final_images/pablo-good-job.png)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            var url_page = window.location.href;
            var url_to_parse = new URL(url_page);
            var code_to_slack = url_to_parse.searchParams.get("code");
            var final = {
                "code": code_to_slack,
                "event_type": "app_installed"
            }
            const stage_url_post = 'https://yvxljjd3fj.execute-api.us-east-1.amazonaws.com'

            $.ajax({
                url: stage_url_post,
                type: "POST",
                data: JSON.stringify(final),
                contentType: "application/json",
                success: function (result) {
                    console.log(result) // when it comes from Slack app, it is of datatype string 
                    result = JSON.parse(result) // convert to dict i.e. object back again
                    // to generate this type of url https://slack.com/app_redirect?app=A010K7NH1RR&team=T010R08RW20&tab=home
                    var app_id = result["app_id"];
                    var slack_team_id = result["slack_team_id"];
                    var deep_link_url = `https://slack.com/app_redirect?app=${app_id}&team=${slack_team_id}&tab=home`;
                    var link_html = `<a class="button   button--accent-bg " href=${deep_link_url}><span>Open Kaapi inside Slack</span></a>`
                    $(link_html).insertBefore("#disclaimer_success_page");
                }
            });

        </script>
    </div>
</body>

</html>